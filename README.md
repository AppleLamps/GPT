# ChatGPT Clone Frontend (GPT-4o / o3-mini / Custom GPTs / TTS / Image Gen)

## Overview

This project is a feature-rich, browser-based frontend designed to interact with OpenAI's language models. It provides a user interface inspired by ChatGPT, enabling conversations with `gpt-4o` (using the `/v1/responses` API) and `o3-mini` (using the `/v1/chat/completions` API).

A key focus of this application is local persistence and customization. All chat history, API settings, and **Custom GPT configurations** (including name, description, instructions, capabilities, and knowledge file content) are stored directly in the browser's `localStorage`.

The application includes:
*   **Custom GPT** functionality: Create, edit, and manage personalized GPTs with specific instructions, capabilities (like web search), and knowledge bases (uploaded TXT, MD, PDF files).
*   **Text-to-Speech (TTS):** Playback AI responses using OpenAI's `gpt-4o-mini-tts` model, with customizable instructions (tone, speed) via the settings panel.
*   **Image Generation:** Generate images using DALL-E 3 based on user prompts when `gpt-4o` is the effective model.
*   **Multi-modal Input:** Supports text, image uploads (JPG/PNG for `gpt-4o`), and per-message file attachments (TXT/MD/PDF).

**Note:** This is a frontend-only application. Your OpenAI API key is stored locally in the browser and sent directly to the OpenAI API. This is suitable for personal use or demos but not recommended for production environments where the key could be exposed.

## Key Features

*   **Dual API/Model Support:**
    *   Intelligently routes requests to OpenAI's `/v1/responses` API for `gpt-4o` or `/v1/chat/completions` API for `o3-mini` based on the *effective* model selection (default setting or Custom GPT configuration).
    *   Handles streaming responses from both API endpoints.
*   **Input Methods:**
    *   Standard text input with automatic resizing.
    *   Image upload (JPG/PNG) for `gpt-4o` prompts (via image icon).
    *   Per-message file attachments (TXT, MD, PDF) for context injection (via paperclip icon).
*   **Output & Interaction:**
    *   Streaming AI responses displayed incrementally.
    *   Markdown rendering for formatted AI responses (using `marked.js`).
    *   Copy-to-clipboard action for AI message text (or image URL).
    *   Regenerate response action for AI messages.
    *   **Text-to-Speech (TTS):** Playback AI responses using `gpt-4o-mini-tts` via a speaker icon on each message. TTS instructions (e.g., tone, speed) can be configured in General Settings. Manages audio playback state (loading, playing, stopping).
    *   **Image Generation Display:** Renders images generated by DALL-E 3 directly in the chat, along with any revised prompt used by the model.
*   **Custom GPT Management:**
    *   Create, edit, and delete Custom GPT configurations via a dedicated modal accessed from the sidebar.
    *   Define: Name, Description, Instructions (System Prompt).
    *   Enable Capabilities: Web Search toggle (requires `gpt-4o`).
    *   Upload Knowledge Files: Attach TXT, MD, or PDF files (content read, validated, and stored within the configuration in `localStorage`, subject to size limits).
    *   Activate Custom GPTs from the sidebar list to tailor conversations. The active GPT's name is displayed in the header.
*   **Persistence (`localStorage`):**
    *   Saves/loads individual chat conversations (`chatStore.js`).
    *   Automatically saves the current *non-Custom GPT* chat when starting a new one or loading another.
    *   Dynamically lists saved chats in the sidebar for easy access and deletion.
    *   Persists Custom GPT configurations, including instructions and *embedded knowledge file content* (`gptStore.js`). Includes checks against `localStorage` size limits.
*   **Settings & Configuration:**
    *   **General Settings Modal:** Configure OpenAI API Key, set the *default* model (`gpt-4o` or `o3-mini`) used when no Custom GPT is active, and set custom instructions for TTS playback. All settings stored locally.
*   **UI Components:**
    *   Responsive layout with collapsible sidebar.
    *   Main chat interface with user/AI message bubbles.
    *   Separate Modals for General Settings and Custom GPT creation/editing.
    *   Toast notifications for user feedback (success, error, info).
    *   Input toolbar with buttons/toggles for image upload, file attachment, web search, image generation mode. Button states update based on the *effective* model.
    *   Header displays the default model selector (dropdown) and the name of the currently active Custom GPT (if any).

## Technology Stack

*   **Frontend:** HTML5, CSS3, JavaScript (Vanilla ES Modules)
*   **Markdown Rendering:** `marked.js` (via CDN)
*   **PDF Text Extraction:** `pdf.js` (via CDN)
*   **API:** OpenAI API (`/v1/chat/completions`, `/v1/responses`, `/v1/audio/speech`, `/v1/images/generations`)
*   **Storage:** Browser `localStorage`

## File Structure

```
.
│
├── index.html          # Main HTML file, structure of the page
│
├── css/
│   ├── base.css        # Base styles, resets, CSS variables
│   ├── components.css  # Styles for individual UI components (buttons, messages, modals, etc.)
│   └── layout.css      # Styles for page structure (header, sidebar, chat area, input area)
│
├── js/
│   ├── main.js         # Main application entry point, initialization logic
│   ├── api.js          # Handles API calls (Chat, Responses, TTS, Image Gen) & routing logic
│   ├── state.js        # Manages active session state (settings, history, active GPT, toggles, etc.)
│   ├── chatStore.js    # Manages persistent CHAT storage (localStorage)
│   ├── parser.js       # Parses Markdown using 'marked', handles streaming text accumulation
│   ├── utils.js        # Utility functions (escapeHTML, copy, base64, file reading, PDF processing, ID generation)
│   │
│   ├── components/     # Modules for specific UI parts
│   │   ├── header.js       # Header logic (default model dropdown, active GPT display, settings button)
│   │   ├── chatInput.js    # Input area, image/file upload, toolbar logic (search, image gen toggles)
│   │   ├── messageList.js  # Message rendering, streaming updates, typing indicator, TTS button logic, history rendering
│   │   ├── notification.js # Displaying temporary toast notifications
│   │   ├── settingsModal.js# General settings modal logic (API key, default model, TTS instructions)
│   │   ├── sidebar.js      # Sidebar logic (visibility, chat & GPT lists, loading/deleting chats/GPTs, new chat)
│   │   └── welcomeScreen.js# Initial welcome screen logic, example prompts
│   │
│   └── customGpt/      # Modules for Custom GPT functionality
│       ├── gptStore.js       # Manages persistent CUSTOM GPT CONFIG storage (localStorage), handles size limits
│       ├── knowledgeHandler.js# Handles processing/validation of knowledge files for the creator modal
│       └── creatorScreen.js  # Logic for the Custom GPT creator/editor modal UI
│
└── README.md           # This file
```

## Core Functionality Breakdown

*   **API Routing (`api.js`):** Determines whether to call Chat Completions (`o3-mini`), Responses (`gpt-4o`), Image Generations (DALL-E 3), or TTS (`gpt-4o-mini-tts`) API based on the *effective* model and user actions. If a Custom GPT is active, its instructions, knowledge content, and capability settings are retrieved from `state.js` and injected into the appropriate API request payload. Handles streaming for chat/responses.
*   **State Management (`state.js`):** Holds the current session's data: API key, *default* model setting, *TTS instructions*, current chat history, active chat ID (from `chatStore`), *active Custom GPT configuration* (loaded from `gptStore`), staged image/files for the next message, *web search toggle state*, *image generation mode state*, *last generated image URL*, and the `previous_response_id` for ongoing `/v1/responses` conversations.
*   **Persistence (`chatStore.js`, `gptStore.js`):**
    *   `chatStore.js`: Handles saving/loading/deleting individual chat histories to/from `localStorage`. Manages the list of chat metadata.
    *   `gptStore.js`: Handles saving/loading/deleting Custom GPT configurations. Stores the *entire config*, including name, description, instructions, capabilities, and *knowledge file content*, in `localStorage`. Includes checks to prevent exceeding typical `localStorage` size limits (around 5MB). Manages the list of config metadata.
*   **Chat History (`chatStore.js`, `sidebar.js`, `messageList.js`):** Regular chats are saved automatically when switching contexts (new chat, load chat). The sidebar lists saved chats, allowing users to load or delete them. `messageList.js` renders the history from `state.js` upon loading.
*   **Custom GPTs (`customGpt/` modules, `sidebar.js`, `state.js`, `api.js`, `header.js`):**
    *   `creatorScreen.js`: Manages the UI modal for creating/editing configs (name, description, instructions, capabilities, knowledge file list). Uses `knowledgeHandler.js` for file processing and `gptStore.js` for saving/updating.
    *   `knowledgeHandler.js`: Processes uploaded files (TXT, MD, PDF) *within the creator modal*, validating type/size, reading content, and returning results to `creatorScreen.js`.
    *   `gptStore.js`: Saves/loads/deletes the complete configuration (including file content) in `localStorage`.
    *   `sidebar.js`: Lists available Custom GPTs from `gptStore`. Handles activation (loads config into `state.js`, clears chat), edit (opens `creatorScreen.js`), and delete actions.
    *   `state.js`: Stores the currently active Custom GPT configuration object.
    *   `api.js`: Injects the active config's instructions and knowledge content into the prompt sent to the OpenAI API.
    *   `header.js`: Updates the header display to show the name of the active Custom GPT.
*   **Text-to-Speech (`messageList.js`, `api.js`, `state.js`):**
    *   A "Listen" button (speaker icon) appears on completed AI text messages.
    *   `messageList.js::handleListenClick`: Stops previous audio, sets loading state, retrieves custom TTS instructions from `state.js`.
    *   Calls `api.js::fetchSpeech`, passing the message text and instructions to the `/v1/audio/speech` endpoint (using `gpt-4o-mini-tts`).
    *   Receives an audio Blob, creates a URL, and plays it using the browser's `Audio` API.
    *   Manages playback state (loading, playing, error, ended) and cleans up resources (`stopCurrentAudio`).
*   **Image Generation (`chatInput.js`, `api.js`, `state.js`, `messageList.js`):**
    *   `chatInput.js`: Toggles image generation mode via button, updates placeholder. On send, checks mode and prompt.
    *   `api.js::fetchImageGeneration`: Calls `/v1/images/generations` (DALL-E 3) with the prompt.
    *   `messageList.js`: Renders the generated image and any revised prompt in an AI message bubble. Disables regenerate/listen actions for image messages.
    *   `state.js`: Stores the `isImageGenerationMode` flag and the `lastGeneratedImageUrl` (used by `api.js` if the *next* user message should reference the generated image).
*   **Input Handling (`chatInput.js`):** Manages the text area, image preview/removal (for user uploads), per-message file attachment/preview/removal, and the state/availability of toolbar buttons (Web Search, Image Generation, Image Upload, File Add) based on the *effective* model (default or Custom GPT). Calls `api.routeApiCall` on send.
*   **Streaming & Parsing (`api.js`, `parser.js`, `messageList.js`):**
    *   `api.js`: Reads streaming responses from both API types.
    *   `parser.js`: Accumulates raw text (`accumulateChunkAndGetEscaped`), returning escaped chunks for immediate display. Provides final parsed HTML (`parseFinalHtml`) using `marked.js`.
    *   `messageList.js`: Creates AI message container, appends escaped chunks via `appendAIMessageContent`, finalizes with parsed HTML via `finalizeAIMessageContent`, and sets up action buttons.

## Setup

1.  Clone or download this repository.
2.  Open the `index.html` file in a modern web browser.
    *   **Note:** Due to browser security policies (CORS) when loading ES Modules or the `pdf.js` worker from local files (`file://`), you **must** serve the files using a simple local web server. Many tools can do this, e.g.:
        *   Using Python: `python -m http.server 8000` (or `python3 ...`) in the project directory.
        *   Using Node.js: Install `npm install -g serve` then run `serve .` in the project directory.
        *   Using VS Code Live Server extension.
    *   Access the application via `http://localhost:8000` (or the appropriate port configured by your server).

## Usage

1.  **Open Settings:** Click the "Settings" button in the sidebar footer or the settings icon in the header.
2.  **Enter API Key:** Paste your OpenAI API key into the designated field.
3.  **Set Defaults:**
    *   Choose your preferred **default** model (`gpt-4o` or `o3-mini`). This is used when no Custom GPT is active.
    *   (Optional) Enter default instructions for Text-to-Speech playback (e.g., "Speak clearly and calmly.").
4.  **Save Settings.** Your key and preferences are stored locally in the browser.
5.  **Start Chatting (Default Mode):** Type messages in the input box and press Enter or click the send button.
6.  **Use Features (Default Mode):**
    *   **Image Upload:** Click the image icon (requires `gpt-4o` to be the effective model).
    *   **File Attachment:** Click the paperclip icon to attach TXT/MD/PDF files to the *next* message (primarily useful with `gpt-4o`).
    *   **Web Search:** Click the "Search" button to toggle web search for the *next* message (requires `gpt-4o` to be the effective model).
    *   **Image Generation:** Click the "Generate Image" button to toggle image generation mode (requires `gpt-4o`). Enter a prompt and send.
    *   **TTS:** Click the speaker icon on a completed AI text response to hear it read aloud using your configured instructions.
7.  **Manage Chats:** Use the sidebar ("Chats" section) to start new chats or load/delete previous regular chat conversations.
8.  **Manage Custom GPTs:**
    *   **Create:** Click the "+" button in the "Custom GPTs" sidebar section to open the creator modal.
    *   **Configure:** Define Name, Description, Instructions. Toggle Capabilities (Web Search). Upload Knowledge Files (TXT, MD, PDF - mind the size limits).
    *   **Save:** Click "Save". The configuration (including file content) is stored locally.
    *   **Activate:** Click a saved Custom GPT in the sidebar list. The header will update, and the chat context will reset for this GPT.
    *   **Edit/Delete:** Hover over a Custom GPT in the list to reveal Edit (pencil) and Delete (trash) buttons. Edit opens the creator modal pre-filled. Delete prompts for confirmation.

## Configuration

*   **OpenAI API Key:** **Required.** Entered in the General Settings modal. Stored in `localStorage`.
*   **Default Model:** Selected in the General Settings modal or header dropdown. Stored in `localStorage`. This is the fallback when no Custom GPT is active.
*   **TTS Instructions:** Optional. Entered in the General Settings modal. Stored in `localStorage`. Affects voice characteristics.
*   **AI Voice Disclosure:** The application includes notes (e.g., below the input area and via notification during playback) stating that AI voices are generated by OpenAI, as required by their policy. Ensure this remains visible or adapt as needed.

## Limitations & Known Issues

*   **`localStorage` Size Limit:** Storing Custom GPT knowledge file content directly can quickly consume the browser's `localStorage` quota (typically 5-10MB total per domain). `gptStore.js` includes a size estimation and check before saving, but large files or numerous configs can cause saving to fail.
*   **API Key Security:** As a purely frontend application, the OpenAI API key is stored in the browser's `localStorage` and sent directly from the client to OpenAI. This is not secure for production or shared environments.
*   **PDF Processing:** Relies on the `pdf.js` library and its worker script loaded from a CDN. Network issues or CDN changes could affect PDF reading. Requires serving files via HTTP(S) due to browser security restrictions with workers. Password-protected PDFs are not supported.
*   **No Backend/User Accounts:** All data (chats, configs, API key) is local to the specific browser instance. There is no synchronization, sharing, or user management. Clearing browser data will erase everything.
*   **Basic Error Handling:** While some API errors are caught, complex issues or unexpected API responses might not be handled gracefully.
*   **Features Not Implemented:** Buttons like "Deep Research", "Voice Input", "Dark Mode", "Help & FAQ", "Log out" are placeholders and show an "unimplemented" notification.

## Future Enhancements (Ideas)

*   Implement backend storage (e.g., Firebase, Supabase, custom server) for secure API key handling, user accounts, and overcoming `localStorage` limits for knowledge files.
*   Add support for more Custom GPT capabilities (e.g., Code Interpreter if an API becomes available).
*   Implement Voice Input using browser SpeechRecognition API.
*   Add Chat Folders for organization.
*   Implement UI Themes (e.g., Dark Mode toggle).
*   Allow selection of different TTS voices (alloy, echo, fable, onyx, nova, shimmer).
*   More robust error handling and user feedback.
*   Option to export/import Custom GPT configurations.